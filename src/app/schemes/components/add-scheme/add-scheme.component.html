<!-- Form Inputs -->
<div class="row g-4">
    <form [formGroup]="schemeForm" class="scalable-gap-24-16 scalable-p-16-8 cardBackground d-flex flex-column">
        <!-- Back Arrow -->
        <div class="d-flex gap-2 align-items-center mb-3">
            <img src="assets/images/svg/Back-Icon.svg" (click)="goBack()" class="cursor-pointer" height="30"
                width="30" />
            <h2 class="font-18 medium black mb-0">
                {{ mode === 'add' ? 'Add New Scheme' : mode === 'edit' ? 'Scheme Project' : 'Scheme Details' }}
            </h2>
        </div>

        <div class="row g-4">
            <!-- Scheme Name -->
            <div class="col-md-6">
                <label class="form-label">Scheme Name
                    <span class="text-danger" *ngIf="isFieldRequired('name') && mode === 'add'">*</span>
                </label>
                <input type="text" formControlName="name" class="input-field" placeholder="Enter Scheme Name"
                    [readonly]="mode === 'view'" />
                <div *ngIf="schemeForm.get('name')?.invalid && schemeForm.get('name')?.touched && mode !== 'view'"
                    class="text-danger">Name is Required</div>
            </div>

            <!-- Category -->
            <div class="col-md-6">
                <label class="form-label">Category
                    <span class="text-danger" *ngIf="isFieldRequired('categoryId') && mode === 'add'">*</span>
                </label>
                <ng-container *ngIf="mode !== 'view' && mode !== 'edit'; else viewCategory">
                    <select formControlName="categoryId" class="input-field">
                        <option value="">Select Category</option>
                        <option *ngFor="let category of categories" [value]="category.id">{{ category.name }}</option>
                    </select>
                    <div *ngIf="schemeForm.get('categoryId')?.invalid && schemeForm.get('categoryId')?.touched"
                        class="text-danger">
                        Category is Required
                    </div>
                </ng-container>
                <ng-template #viewCategory>
                    <div class="input-field bg-light-subtle border p-2 rounded">
                        {{ schemeDetails.category }}
                    </div>
                </ng-template>
            </div>


            <!-- Criteria -->
            <div class="col-md-6">
                <label class="form-label">Criteria
                    <span class="text-danger" *ngIf="(isFieldRequired('criteria') && mode === 'add') || (isFieldRequired('criteria') && mode === 'edit')">*</span>
                </label>
                <input type="text" formControlName="criteria" class="input-field" placeholder="Enter Criteria"
                    [readonly]="mode === 'view'" />
                <div *ngIf="schemeForm.get('criteria')?.invalid && schemeForm.get('criteria')?.touched && mode !== 'view'"
                    class="text-danger">Criteria is Required</div>
            </div>

            <!-- Process -->
            <div class="col-md-6">
                <label class="form-label">Process
                     <span class="text-danger" *ngIf="(isFieldRequired('criteria') && mode === 'add') || (isFieldRequired('criteria') && mode === 'edit')">*</span>
                </label>
                <input type="text" formControlName="process" class="input-field" placeholder="Enter Process"
                    [readonly]="mode === 'view'" />
                <div *ngIf="schemeForm.get('process')?.invalid && schemeForm.get('process')?.touched && mode !== 'view'"
                    class="text-danger">Process Required</div>
            </div>

            <!-- Benefits -->
            <div class="col-md-6">
                <label class="form-label">Benefits
                     <span class="text-danger" *ngIf="(isFieldRequired('criteria') && mode === 'add') || (isFieldRequired('criteria') && mode === 'edit')">*</span>
                </label>
                <input type="text" formControlName="benefits" class="input-field" placeholder="Enter Benefits"
                    [readonly]="mode === 'view'" />
                <div *ngIf="schemeForm.get('benefits')?.invalid && schemeForm.get('benefits')?.touched && mode !== 'view'"
                    class="text-danger">Benefits Required</div>
            </div>

            <!-- Status -->
            <div class="col-md-6" *ngIf="mode === 'add'">
                <label class="form-label">status
                    <span class="text-danger" *ngIf="isFieldRequired('name') && mode === 'add'">*</span>
                </label>
                <select formControlName="status" class="input-field">
                    <option value="">Select Status</option>
                    <option value="DRAFT">DRAFT</option>
                    <option value="PUBLISHED">PUBLISHED</option>
                </select>
                <div *ngIf="schemeForm.get('status')?.invalid && schemeForm.get('status')?.touched" class="text-danger">
                    Status is Required</div>
            </div>

            <div class="col-md-6" *ngIf="mode !== 'add' && role !== 'RESIDENT'">
                <label class="form-label">Status</label>
                <div class="input-field bg-light-subtle border p-2 rounded">{{ schemeDetails.status }}</div>
            </div>

            <!-- Created By -->
            <div class="col-md-6" *ngIf="mode === 'view' && role !== 'RESIDENT'">
                <h4 class="mb-0 font-14 regular subTextColor">Created By</h4>
                <div class="input-field">{{ schemeDetails.createdBy }}</div>
            </div>

            <!-- Created At -->
            <div class="col-md-6" *ngIf="mode !== 'add' && role !== 'RESIDENT'">
                <label class="form-label">Created At</label>
                <div class="input-field bg-light-subtle border p-2 rounded">{{ schemeDetails.createdAt | date:'medium'
                    }}</div>
            </div>

            <!-- Updated At -->
            <div class="col-md-6" *ngIf="mode !== 'add' && role !== 'RESIDENT'">
                <label class="form-label">Updated At</label>
                <div class="input-field bg-light-subtle border p-2 rounded">{{ schemeDetails.updatedAt | date:'medium'
                    }}</div>
            </div>

            <!-- Is Active -->
            <div class="col-md-6" *ngIf="mode !== 'add' && role !== 'RESIDENT'">
                <label class="form-label">Is Active</label>
                <div class="input-field bg-light-subtle border p-2 rounded">
                    <span
                        [ngClass]="{ 'text-success': schemeDetails.isActive, 'text-danger': !schemeDetails.isActive }">
                        {{ schemeDetails.isActive ? 'Active' : 'Inactive' }}
                    </span>
                </div>
            </div>

            <!-- Attachments Upload -->
            <div class="col-md-6" *ngIf="mode !== 'view' && role !== 'RESIDENT'">
                <ng-container *ngIf="selectedFiles.length > 0">
                    <h4 class="mb-0 font-14 regular subTextColor">Attachments</h4>
                </ng-container>
                <input type="file" class="input-field" (change)="onFileSelected($event)" multiple />
                <ul class="mt-2">
                    <li *ngFor="let file of selectedFiles; let i = index">
                        {{ file.name }}
                        <i class="bi bi-x-circle-fill ms-2 text-danger cursor-pointer"
                            (click)="removeAttachment(i)"></i>
                    </li>
                </ul>
            </div>

            <!-- Attachment Viewer -->
            <div class="col-md-6" *ngIf="attachmentUrls.length > 0 && (mode === 'edit' || mode === 'view')">
                <h4 class="mb-0 font-14 regular subTextColor">Attachments</h4>
                <div class="attachment-list">
                    <div *ngFor="let url of attachmentUrls; let i = index"
                        class="attachment-item d-flex align-items-center gap-2">
                        <!-- If Image -->
                        <ng-container *ngIf="isImage(url)">
                            <img [src]="url" alt="Attachment" class="attachment-image" (click)="openImageViewer(i)" />
                        </ng-container>

                        <!-- If PDF -->
                        <ng-container *ngIf="isPdf(url)">
                            <a [href]="url" target="_blank" class="attachment-file-link">üìÑ {{ getFileName(url) }}</a>
                        </ng-container>

                        <!-- Remove Button -->
                        <i *ngIf="mode === 'edit'" class="bi bi-x-circle-fill text-danger cursor-pointer"
                            (click)="removeExistAttachment(i)"></i>
                    </div>
                </div>
            </div>

            <!-- Image Viewer Modal -->
            <div *ngIf="isViewerOpen" class="image-viewer-overlay">
                <span class="close-btn" (click)="closeImageViewer()">√ó</span>
                <img [src]="attachmentUrls[currentImageIndex]" class="full-image" />
                <button class="nav-btn prev" (click)="prevImage()" [disabled]="currentImageIndex === 0">‚ùÆ</button>
                <button class="nav-btn next" (click)="nextImage()"
                    [disabled]="currentImageIndex === attachmentUrls.length - 1">‚ùØ</button>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="d-flex justify-content-end gap-4 mt-4" *ngIf="mode !== 'view'">
            <button type="button" class="secondary-button py-2 scalable-p-48-24" (click)="onCancel()">Cancel</button>
            <button type="submit" class="primary-button py-2 scalable-p-48-24"
                [disabled]="schemeForm.invalid || isSubmitting" (click)="onSubmit()">
                {{ isSubmitting ? 'Submitting...' : 'Submit' }}
            </button>
        </div>
    </form>
</div>