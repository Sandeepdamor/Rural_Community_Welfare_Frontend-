<form [formGroup]="localEventForm" (ngSubmit)="onSubmit()"
  class="scalable-gap-24-16 scalable-p-16-8 cardBackground d-flex flex-column">
  <!-- Back Arrow -->
  <div class="d-flex gap-2 align-items-center">
    <img src="assets/images/svg/Back-Icon.svg" class="cursor-pointer" height="30" width="30" (click)="goBack()" />
    <h2 class="font-18 medium black mb-0">Add Event</h2>
  </div>

  <!-- Form Inputs -->
  <div class="row g-4">
    <!-- Title -->
    <!-- Subject -->
    <div class="col-md-6">
      <div class="d-flex flex-column gap-1 w-100">
        <h4 class="mb-0 font-14 regular subTextColor">Name <span class="text-danger">*</span></h4>
        <input type="text" formControlName="name" class="input-field" placeholder="Enter Name of Event"
          [readonly]="isReadOnly" />

        <!-- Error messages -->
        <div *ngIf="localEventForm.get('name')?.touched && localEventForm.get('name')?.invalid"
          class="text-danger mt-1">
          <div *ngIf="localEventForm.get('name')?.errors?.['required']">Subject is required.</div>
          <div *ngIf="localEventForm.get('name')?.errors?.['minlength']">Subject must be at least 3 characters.</div>
          <div *ngIf="localEventForm.get('name')?.errors?.['maxlength']">Subject must not exceed 30 characters.</div>
          <div *ngIf="localEventForm.get('name')?.errors?.['pattern']">Subject must contain only letters and spaces.
          </div>
        </div>
      </div>
    </div>

    <!-- Description -->
    <div class="col-md-6">
      <div class="d-flex flex-column gap-1 w-100">
        <h4 class="mb-0 font-14 regular subTextColor">Description <span class="text-danger">*</span></h4>
        <input type="text" formControlName="description" class="input-field" placeholder="Enter Description" />

        <!-- Error messages -->
        <div *ngIf="localEventForm.get('description')?.touched && localEventForm.get('description')?.invalid"
          class="text-danger mt-1">
          <div *ngIf="localEventForm.get('description')?.errors?.['required']">Description is required.</div>
          <div *ngIf="localEventForm.get('description')?.errors?.['minlength']">Must be at least 10 characters.</div>
          <div *ngIf="localEventForm.get('description')?.errors?.['maxlength']">Must not exceed 100 characters.</div>
          <div *ngIf="localEventForm.get('description')?.errors?.['pattern']">
            Must contain at least one capital letter and only letters, numbers, spaces, commas, periods, or hyphens.
          </div>
        </div>
      </div>
    </div>

    <!-- Start Date -->
    <div class="col-md-6">
      <div class="d-flex flex-column gap-1 w-100">
        <h4 class="mb-0 font-14 regular subTextColor">Start Date <span class="text-danger">*</span></h4>
        <input type="date" formControlName="startDate" class="input-field" [min]="today" />

        <div *ngIf="localEventForm.get('startDate')?.touched && localEventForm.get('startDate')?.invalid"
          class="text-danger mt-1">
          <div *ngIf="localEventForm.get('startDate')?.errors?.['required']">Start Date is required.</div>
        </div>
      </div>
    </div>

    <!-- End Date -->
    <div class="col-md-6">
      <div class="d-flex flex-column gap-1 w-100">
        <h4 class="mb-0 font-14 regular subTextColor">
          End Date <span class="text-danger">*</span>
        </h4>

        <input type="date" formControlName="endDate" class="input-field"
          [min]="localEventForm.get('startDate')?.value || today" />

        <!-- Field-level validation -->
        <div *ngIf="localEventForm.get('endDate')?.touched && localEventForm.get('endDate')?.invalid"
          class="text-danger mt-1">
          <div *ngIf="localEventForm.get('endDate')?.errors?.['required']">
            End Date is required.
          </div>
        </div>

        <!-- ðŸ‘‡ Add this after the field-level validation -->
        <div *ngIf="localEventForm.errors?.['dateRangeInvalid'] && localEventForm.get('endDate')?.touched"
          class="text-danger mt-1">
          End Date must be after Start Date.
        </div>
      </div>
    </div>






    <!-- Attachments -->
    <div class="col-md-6">
      <div class="d-flex flex-column gap-1 w-100">
        <h4 class="mb-0 font-14 regular subTextColor">Attachments</h4>
        <input type="file" class="input-field" (change)="onFileSelected($event)" multiple />
      </div>
      <!-- Show Selected File Names -->
      <ul class="mt-2">
        <li *ngFor="let file of selectedFiles; let i = index">
          {{ file.name }} <span class="text-danger cursor-pointer ms-2" (click)="removeAttachment(i)">Ã—</span>
        </li>
      </ul>
    </div>



    <div class="col-md-6" [formGroup]="localEventForm">

      <h4 class="mb-0 font-14 regular subTextColor">Village Location</h4>
      <select class="village-select" formControlName="locationId"
        [ngClass]="{ 'is-invalid': isFieldInvalid('locationId') }">
        <option [ngValue]="null">-- Select Location --</option>
        <option *ngFor="let loc of locations" [ngValue]="loc.id">
          {{ loc.formattedAddress }}
        </option>
      </select>

      <div *ngIf="isFieldInvalid('locationId')" class="invalid-feedback">
        Please select a location.
      </div>
    </div>
  </div>

  <!-- Buttons -->
  <div class="d-flex justify-content-end gap-4">
    <button type="button" class="secondary-button py-2 scalable-p-48-24">Cancel</button>
    <button type="submit" class="primary-button py-2 scalable-p-48-24">Save</button>
  </div>
</form>